!function(e){function t(e){var t=e.originalEvent.changedTouches,a=t[0],i="";switch(e.type){case"touchmove":i="mousemove";break;case"touchend":i="mouseup";break;default:return}var r=document.createEvent("MouseEvent");r.initMouseEvent(i,!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(r),e.preventDefault()}e.rateit={aria:{resetLabel:"reset rating",ratingLabel:"rating"}},e.fn.rateit=function(a,i){var r=1,n={},s="init",l=function(e){return e.charAt(0).toUpperCase()+e.substr(1)};if(0==this.length)return this;var d=e.type(a);if("object"==d||void 0===a||null==a)n=e.extend({},e.fn.rateit.defaults,a);else{if("string"==d&&"reset"!==a&&void 0===i)return this.data("rateit"+l(a));"string"==d&&(s="setvalue")}return this.each(function(){var d=e(this),h=function(e,t){if(null!=t){var a="aria-value"+("value"==e?"now":e),i=d.find(".rateit-range");void 0!=i.attr(a)&&i.attr(a,t)}return arguments[0]="rateit"+l(e),d.data.apply(d,arguments)};if("reset"==a){var o=h("init");for(var u in o)d.data(u,o[u]);if(h("backingfld")){var v=e(h("backingfld"));v.val(h("value")),v[0].min&&(v[0].min=h("min")),v[0].max&&(v[0].max=h("max")),v[0].step&&(v[0].step=h("step"))}d.trigger("reset")}d.hasClass("rateit")||d.addClass("rateit");var m="rtl"!=d.css("direction");if("setvalue"==s){if(!h("init"))throw"Can't set value before init";if("readonly"!=a||1!=i||h("readonly")||(d.find(".rateit-range").unbind(),h("wired",!1)),"value"==a&&(i=null==i?h("min"):Math.max(h("min"),Math.min(h("max"),i))),h("backingfld")){var v=e(h("backingfld"));"value"==a&&v.val(i),"min"==a&&v[0].min&&(v[0].min=i),"max"==a&&v[0].max&&(v[0].max=i),"step"==a&&v[0].step&&(v[0].step=i)}h(a,i)}if(!h("init")){if(h("min",isNaN(h("min"))?n.min:h("min")),h("max",isNaN(h("max"))?n.max:h("max")),h("step",h("step")||n.step),h("readonly",void 0!==h("readonly")?h("readonly"):n.readonly),h("resetable",void 0!==h("resetable")?h("resetable"):n.resetable),h("backingfld",h("backingfld")||n.backingfld),h("starwidth",h("starwidth")||n.starwidth),h("starheight",h("starheight")||n.starheight),h("value",Math.max(h("min"),Math.min(h("max"),isNaN(h("value"))?isNaN(n.value)?n.min:n.value:h("value")))),h("ispreset",void 0!==h("ispreset")?h("ispreset"):n.ispreset),h("backingfld")){var v=e(h("backingfld"));h("value",v.hide().val()),(v.attr("disabled")||v.attr("readonly"))&&h("readonly",!0),"INPUT"==v[0].nodeName&&("range"==v[0].type||"text"==v[0].type)&&(h("min",parseInt(v.attr("min"))||h("min")),h("max",parseInt(v.attr("max"))||h("max")),h("step",parseInt(v.attr("step"))||h("step"))),"SELECT"==v[0].nodeName&&v[0].options.length>1&&(h("min",Number(v[0].options[0].value)),h("max",Number(v[0].options[v[0].length-1].value)),h("step",Number(v[0].options[1].value)-Number(v[0].options[0].value)))}var c="DIV"==d[0].nodeName?"div":"span";r++;var f='<button id="rateit-reset-{{index}}" data-role="none" class="rateit-reset" aria-label="'+e.rateit.aria.resetLabel+'" aria-controls="rateit-range-{{index}}"></button><{{element}} id="rateit-range-{{index}}" class="rateit-range" tabindex="0" role="slider" aria-label="'+e.rateit.aria.ratingLabel+'" aria-owns="rateit-reset-{{index}}" aria-valuemin="'+h("min")+'" aria-valuemax="'+h("max")+'" aria-valuenow="'+h("value")+'"><{{element}} class="rateit-selected" style="height:'+h("starheight")+'px"></{{element}}><{{element}} class="rateit-hover" style="height:'+h("starheight")+'px"></{{element}}></{{element}}>';d.append(f.replace(/{{index}}/gi,r).replace(/{{element}}/gi,c)),m||(d.find(".rateit-reset").css("float","right"),d.find(".rateit-selected").addClass("rateit-selected-rtl"),d.find(".rateit-hover").addClass("rateit-hover-rtl")),h("init",JSON.parse(JSON.stringify(d.data())))}d.find(".rateit-selected, .rateit-hover").height(h("starheight"));var g=d.find(".rateit-range");g.width(h("starwidth")*(h("max")-h("min"))).height(h("starheight"));var p="rateit-preset"+(m?"":"-rtl");if(h("ispreset")?d.find(".rateit-selected").addClass(p):d.find(".rateit-selected").removeClass(p),null!=h("value")){var b=(h("value")-h("min"))*h("starwidth");d.find(".rateit-selected").width(b)}var w=d.find(".rateit-reset");w.data("wired")!==!0&&w.bind("click",function(e){e.preventDefault(),w.blur(),d.rateit("value",null),d.trigger("reset")}).data("wired",!0);var x=function(t,a){var i=a.changedTouches?a.changedTouches[0].pageX:a.pageX,r=i-e(t).offset().left;return m||(r=g.width()-r),r>g.width()&&(r=g.width()),0>r&&(r=0),b=Math.ceil(r/h("starwidth")*(1/h("step")))},y=function(e){var t=e*h("starwidth")*h("step"),a=g.find(".rateit-hover");if(a.data("width")!=t){g.find(".rateit-selected").hide(),a.width(t).show().data("width",t);var i=[e*h("step")+h("min")];d.trigger("hover",i).trigger("over",i)}},N=function(t){h("value",t),h("backingfld")&&e(h("backingfld")).val(t),h("ispreset")&&(g.find(".rateit-selected").removeClass(p),h("ispreset",!1)),g.find(".rateit-hover").hide(),g.find(".rateit-selected").width(t*h("starwidth")-h("min")*h("starwidth")).show(),d.trigger("hover",[null]).trigger("over",[null]).trigger("rated",[t])};h("readonly")?w.hide():(h("resetable")||w.hide(),h("wired")||(g.bind("touchmove touchend",t),g.mousemove(function(e){var t=x(this,e);y(t)}),g.mouseleave(function(){g.find(".rateit-hover").hide().width(0).data("width",""),d.trigger("hover",[null]).trigger("over",[null]),g.find(".rateit-selected").show()}),g.mouseup(function(e){var t=x(this,e),a=t*h("step")+h("min");N(a),g.blur()}),g.keyup(function(e){(38==e.which||e.which==(m?39:37))&&N(Math.min(h("value")+h("step"),h("max"))),(40==e.which||e.which==(m?37:39))&&N(Math.max(h("value")-h("step"),h("min")))}),h("wired",!0)),h("resetable")&&w.show()),g.attr("aria-readonly",h("readonly"))})},e.fn.rateit.defaults={min:0,max:5,step:1,starwidth:24,starheight:24,readonly:!1,resetable:!1,ispreset:!1},e(function(){e("div.plugin-rateit, span.plugin-rateit").rateit()})}(jQuery);